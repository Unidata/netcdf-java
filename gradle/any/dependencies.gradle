// Gradle dependency management.
// This technique was inspired by: http://stackoverflow.com/questions/9547170
//
// Usage:
//   All gradle build scripts will apply this script using:
//     apply from: "$rootDir/gradle/any/dependencies.gradle"
//

//================================================ Repositories ================================================//

repositories {
  // Prefer JCenter to Maven Central. See
  // https://blog.bintray.com/2015/02/09/android-studio-migration-from-maven-central-to-jcenter/
  jcenter()
  mavenCentral()  // JCenter isn't quite a superset of Maven Central.

  // All of the hosted repositories below could be replaced with:
  //     url "https://artifacts.unidata.ucar.edu/repository/unidata-all/"
  // which is a group repository that contains all other repositories. However, I prefer to list all source
  // repos explicitly so that we know where all artifacts ultimately come from.

  // Hosted release repositories.
  maven {
    // "visad" and "jj2000".
    url "https://artifacts.unidata.ucar.edu/repository/unidata-releases/"
  }
  maven {
    // For snapshots of "dtswar", "d4ts" (used by tests)
    url "https://artifacts.unidata.ucar.edu/repository/unidata-snapshots/"
  }

  maven {
    url 'https://artifacts.unidata.ucar.edu/repository/unidata-3rdparty/'
    content {
      // this repository *only* contains artifacts with group "org.bounce"
      includeGroup 'org.bounce'
    }
  }
}

//////////////////////////// Transitive dependency replacements and exclusions ////////////////////////////
// Executes the given closure against all objects in this collection, and any objects subsequently added to this
// collection. See org.gradle.api.DomainObjectCollection.all(Closure)

configurations.all {
  resolutionStrategy.dependencySubstitution {
    // Replace every instance of "commons-logging" in the dependency tree with "jcl-over-slf4j". This effectively
    // converts every JCL call to an slf4j call. We can see the first-level dependencies that drag in
    // "commons-logging" by commenting-out the rule below and running:
    /*
         ./gradlew -q :cdm:cdm-core:dependencyInsight --configuration compileClasspath --dependency commons-logging

        commons-logging:commons-logging:1.2
        +--- org.apache.httpcomponents:httpclient:4.5.12
        |    ...
     */
    substitute module('commons-logging:commons-logging') because 'we want to control JCL logging with slf4j' with module("org.slf4j:jcl-over-slf4j:${slf4jVersion}")
  }
}
